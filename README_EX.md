# 🏢 사내 인트라넷 & 복리후생 관리 시스템

> 근태 관리에 그쳤던 1.0에서,
> 복리후생, 일정 관리, SMS 알림까지 아우르는 조직 운영의 핵심을 하나의 플랫폼에 담은 인트라넷 2.0입니다.

기업의 인사 업무는 복잡합니다. 출퇴근 기록, 연차 신청, 복지 포인트 관리, 활동비 승인까지 수많은 프로세스가 얽혀 있죠. 이 프로젝트는 그 복잡함을 하나의 시스템으로 통합했습니다. **NestJS**를 기반으로 모듈화된 아키텍처를 설계하여 기능 확장과 유지보수가 용이하도록 구현했습니다.

---

## 🛠 기술 스택 및 선택 이유

### Backend Framework

**NestJS** + **TypeScript**

- **왜 NestJS인가?:** 가장 큰 이유는 회사에서 사용하는 주력 프레임워크이기 때문입니다. NestJS가 제공하는 DI와 모듈 시스템을 활용해 계층을 명확히 분리할 수 있었고, 복잡한 비즈니스 로직을 관리하기에 적합하다고 판단했습니다.
- **TypeScript의 가치:** 타입 안정성은 단순한 편의를 넘어 협업의 기반이라고 생각합니다. DTO, Interface, 타입 선언을 적극적으로 활용해 런타임 에러를 줄이고 코드의 의도를 보다 명확하게 전달할 수 있었습니다.

### Database

**MariaDB** (TypeORM) + **MongoDB** (Mongoose)

- **하이브리드 전략:** 근태나 복리후생처럼 정형화된 데이터는 MariaDB에서 관계형 구조로 관리하고, 점심조나 먼슬리 음료 신청처럼 구조가 유연한 데이터는 MongoDB를 활용해 JSON 형태로 한 번에 저장하는 방식을 선택했습니다.
- **TypeORM의 강점:** TypeORM 역시 회사에서 사용 중인 ORM이라는 점을 고려해 선택했습니다. Entity 기반으로 데이터 모델을 TypeScript 클래스 형태로 정의할 수 있으면서도, 복잡한 쿼리가 필요한 경우에는 Raw Query를 유연하게 사용할 수 있다는 점이 장점입니다.

### Cache & Message Queue

**Redis 활용:**

- **검색 자동완성:** 직원 이름을 prefix 단위로 분해하여 Redis ZSET에 저장하고, 자동완성 검색을 구현했습니다. 매번 DB를 조회하지 않고 O(log N) 시간복잡도로 빠른 검색이 가능합니다.
- **분산 락:** 회의실 예약과 점심조 뽑기 시 동시성 문제를 해결하기 위해 Redis의 SET NX 명령어로 분산 락을 구현했습니다. 여러 사용자가 동시에 같은 회의실 시간대를 예약하거나, 점심조 그룹 정원을 초과하여 배정되는 문제를 방지하여 데이터 정합성을 보장했습니다.

**Bull Queue 활용:**

- **비동기 처리:** SMS 발송 같은 시간이 걸리는 작업을 Bull Queue로 백그라운드에서 처리하여 사용자 응답 시간을 단축했습니다.
- **모니터링:** Bull Board를 통해 큐의 작업 상태(대기, 진행 중, 완료, 실패)를 실시간으로 모니터링할 수 있도록 구현했습니다.

### Infrastructure & Tools

- **AWS S3:** 파일 저장소로 S3를 선택한 이유는 확장성과 안정성입니다. 직원 증명서, 활동비 영수증 등 다양한 파일을 많이, 안전하게 관리할 수 있었습니다.
- **Docker Compose:** Dev 환경과 Production 환경의 일관성을 유지하기 위해 컨테이너화했습니다.
- **Winston:** 로그 관리는 장애 대응의 핵심입니다. 일별 로그 로테이션과 레벨별 분류로 개발 환경에서의 디버깅을 효율화했습니다.
- **Swagger:** API 문서화를 자동화하여 프론트엔드 팀과의 협업 시 커뮤니케이션 비용을 줄였습니다.

---

## 🚘 실행 방법

### 1. 환경 변수 설정

`.env` 파일을 프로젝트 루트에 생성합니다.

```bash
# Server
SERVER_PORT=

# Database
DB_HOST=
DB_PORT=
DB_USER=
DB_PW=
DB_NAME=

# MongoDB
MONGO_URI=

# Redis
REDIS_HOST=
REDIS_PORT=

# JWT
JWT_SECRET=

# AWS S3
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=
AWS_S3_BUCKET=
```

### 2. Docker Compose 실행

```bash
# 이미지 빌드 및 실행
docker compose up -d --build
```

### 3. 테스트 실행

```bash
# 테스트 DB 자동 구성 → 테스트 실행 → DB 정리
npm run test
```

▶️ [e2e 테스트 자동화 구축기 바로가기](https://velog.io/@snghyun331/nestjs-e2e)

<br>

서버가 정상적으로 실행되면,
Swagger 문서는 `http://localhost:{SERVER_PORT}/api`에서 확인할 수 있습니다.

---

## 💡 시스템 구조 및 핵심 기능 소개

### 시스템 구조

이 프로젝트는 **도메인 중심 모듈 설계**를 따릅니다. 각 비즈니스 도메인(User, Welfare, Commute 등)이 독립적인 모듈로 분리되어 있어, 변경 사항이 다른 도메인에 영향을 주지 않습니다.

```
src/
├── module/             # 비즈니스 로직 모듈
│   ├── auth/           # 인증/인가
│   ├── user/           # 직원 관리
│   ├── intranet/       # 인트라넷 핵심 기능
│   │   ├── commute/    # 근태 관리
│   │   ├── leave/      # 연차/휴가
│   │   └── approval/   # 결재(팀장,본부장,대표 권한)
│   ├── welfare/        # 복리후생 관리
│   ├── activity/       # 활동비 관리
│   ├── meal/           # 식대 관리
│   ├── notice/         # 공지사항
│   ├── meeting/        # 회의실 예약
│   ├── notification/   # 알림 시스템
│   │   ├── queue/      # Bull 큐 처리
│   │   └── sms/        # SMS 발송
│   └── scheduler/      # 스케줄 작업 (Cron)
├── entity/             # TypeORM 엔티티 (MariaDB)
├── schema/             # Mongoose 스키마 (MongoDB)
├── common/             # 공통 유틸리티
│   ├── filter/         # 예외 필터
│   ├── interceptor/    # 응답 인터셉터
│   └── guard/          # 권한 가드
└── config/             # 설정 파일
```

### 핵심 기능 상세

#### 1. **근태 관리 시스템**

직원의 출퇴근 기록을 자동으로 집계하고, 연차/휴가 신청을 처리합니다.

- **구현 포인트:** 출퇴근 기록 시 @Transactional을 활용해 여러 DB 작업을 하나의 트랜잭션으로 묶어 데이터 일관성을 보장했습니다. 조합 휴가(오전반차+오후반차 등)를 고려한 근태 계산 로직을 구현했습니다.
- **스케줄러 최적화:** 매일 자정 전 직원의 근태 데이터를 자동 생성하는 스케줄러에서 Raw Query를 활용했습니다. NOT EXISTS 서브쿼리로 중복 생성을 방지하고, 대량 INSERT로 한 번에 처리하여 성능을 최적화했습니다.

#### 2. **복리후생 포인트 시스템**

직원별로 지급된 복지 포인트를 관리하고, 사용 내역을 추적합니다.

- **구현 포인트:** 포인트 생성/수정/삭제 시 @Transactional을 활용해 본인과 동반 결제자의 포인트를 동시에 업데이트하여 데이터 정합성을 유지했습니다.

#### 3. **결재 시스템**

활동비, 휴가 신청 등 다양한 결재 프로세스를 관리합니다.

- **구현 포인트:** 결재 승인/반려 시 @Transactional로 근태 상태, 연차 사용량, 식대 차감일 등 연관된 여러 데이터를 일괄 업데이트했습니다. 단일 휴가와 조합 휴가에 따른 근태 재계산 로직을 구현했습니다.

#### 4. **알림 시스템**

SMS 알림을 비동기로 처리합니다.

- **아키텍처:** SMS 발송 요청이 발생하면 즉시 Bull Queue에 등록하고, Consumer가 백그라운드에서 외부 SMS API를 호출합니다.
- **장점:** 외부 API 지연이 사용자 요청 응답 시간에 영향을 주지 않으며, 실패 시 자동 재시도 로직을 구현했습니다. Bull Board로 큐 상태를 모니터링할 수 있습니다.

### 아키텍처 설계 원칙

- **관심사의 분리:** Controller는 요청 처리, Service는 비즈니스 로직, Repository는 DB(데이터) 접근만 담당합니다.
- **계층적 권한 관리:** 인증(AuthGuard)과 권한(RoleGuard)을 2단계로 분리하고, 직급을 배열로 관리하여 "위원 < 선임 < 책임 < 팀장 < 본부장" 식의 계층 비교를 자동화했습니다. 토큰 만료, 유효하지 않은 토큰 등 다양한 케이스별로 명확한 에러 메시지를 반환하여 에러 이유를 명확히 전달했습니다.
- **전역 예외 처리:** Winston과 통합된 Global Exception Filter를 구현하여 IP 주소, 사용자명, 요청 정보, Stack Trace까지 상세하게 로깅합니다. QueryFailedError를 별도로 캐치하여 DB 관련 에러를 명확히 분류했습니다.
- **Path Alias 활용:** `@common/*`, `@entity/*`, `@schema/*` 등 도메인별 경로 별칭을 설정하여 상대 경로(../../..) 없이 깔끔한 import 구조를 유지했습니다. 이를 통해 코드 가독성을 높였습니다.

---

<div align="right">
  <strong>최종 업데이트:</strong> 2026년 1월 11일
</div>
